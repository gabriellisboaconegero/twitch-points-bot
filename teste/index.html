<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste</title>
</head>
<body>
    <div id="div">
        <div style="width: 100px; height: 100px; background-color: red;"></div>
    </div>
    <button id="1" onclick="desaparecer()">desaparecer</button>
    <button id="2" onclick="aparecer()">aparecer</button>
    
    <script>
        document.getElementById("1").click();
        document.getElementById("2").click();


        function desaparecer(){
            document.getElementById('div').innerHTML = '';
        }
        function aparecer(){
            document.getElementById("div").innerHTML = `<div style="width: 100px; height: 100px; background-color: red;"></div>`
        }
        function waitForElm(selector) {
            return new Promise(resolve => {
                if (document.querySelector(selector)) {
                    return resolve(document.querySelector(selector));
                }

                const observer = new MutationObserver(mutations => {
                    if (document.querySelector(selector)) {
                        resolve(document.querySelector(selector));
                        observer.disconnect();
                    }
                });

                observer.observe(document.body, {
                    childList: true,
                    subtree: true
                });
            });
        }

        function waitForElmToLeft(selector) {
            return new Promise(resolve => {
                if (document.querySelector(selector) == null) {
                    return resolve(document.querySelector(selector));
                }

                const observer = new MutationObserver(mutations => {
                    if (document.querySelector(selector) == null) {
                        resolve(document.querySelector(selector));
                        observer.disconnect();
                    }
                });

                observer.observe(document.body, {
                    childList: true,
                    subtree: true
                });
            });
        }

        waitForElm("#div div").then(teste);

        function o(){
            console.log("desapareceu");
            waitForElm("#div div").then(teste);
        }
        

        function teste(elm){
            console.log("apareceu", elm);
            waitForElmToLeft("#div div").then(o);
        }


    </script>
</body>
</html>